<div class="module-panel" id="knowledge-trends-module">
    <div class="page-header">
        <h1 class="page-title">知识趋势</h1>
        <div class="date-filter">
            <button class="btn btn-outline-secondary dropdown-toggle">
                <i class="bi bi-calendar3"></i> 最近30天
                <i class="bi bi-chevron-down"></i>
            </button>
        </div>
    </div>

    <!-- 数据概览卡片 -->
    <div class="row stat-cards">
        <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-icon bg-primary-soft">
                        <i class="bi bi-file-earmark-plus"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number">389</h3>
                        <p class="stat-label">新增文档</p>
                        <div class="stat-change increase">
                            <i class="bi bi-arrow-up"></i> 15.2%
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-icon bg-info-soft">
                        <i class="bi bi-search"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number">4,218</h3>
                        <p class="stat-label">检索次数</p>
                        <div class="stat-change increase">
                            <i class="bi bi-arrow-up"></i> 18.3%
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-icon bg-success-soft">
                        <i class="bi bi-people"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number">156</h3>
                        <p class="stat-label">活跃用户</p>
                        <div class="stat-change increase">
                            <i class="bi bi-arrow-up"></i> 8.2%
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-icon bg-warning-soft">
                        <i class="bi bi-clock-history"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number">86.4%</h3>
                        <p class="stat-label">知识覆盖率</p>
                        <div class="stat-change decrease">
                            <i class="bi bi-arrow-down"></i> 2.1%
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 知识趋势图表 -->
    <div class="row mt-4">
        <div class="col-xl-8">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="card-title">知识库访问趋势</h5>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-outline-secondary">日</button>
                        <button class="btn btn-sm btn-primary">周</button>
                        <button class="btn btn-sm btn-outline-secondary">月</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="card-title">知识类型分布</h5>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-icon">
                            <i class="bi bi-three-dots-vertical"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 热门搜索关键词和热门文档 -->
    <div class="row mt-4">
        <div class="col-xl-5">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="card-title">热门搜索关键词</h5>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-link">查看全部</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="keywordsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-7">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">热门文档</h5>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-link">更多</button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="popular-docs">
                        <div class="doc-item">
                            <div class="doc-icon">
                                <i class="bi bi-file-earmark-pdf"></i>
                            </div>
                            <div class="doc-info">
                                <h6 class="doc-title">项目管理规范v3.1</h6>
                                <div class="doc-meta">
                                    <span class="doc-category">管理文档</span>
                                    <span class="doc-views"><i class="bi bi-eye"></i> 239</span>
                                </div>
                            </div>
                            <div class="doc-rating">
                                <div class="rating">
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star half">★</span>
                                </div>
                                <span class="rating-value">4.5</span>
                            </div>
                        </div>
                        
                        <div class="doc-item">
                            <div class="doc-icon">
                                <i class="bi bi-file-earmark-word"></i>
                            </div>
                            <div class="doc-info">
                                <h6 class="doc-title">API接口文档</h6>
                                <div class="doc-meta">
                                    <span class="doc-category">技术文档</span>
                                    <span class="doc-views"><i class="bi bi-eye"></i> 186</span>
                                </div>
                            </div>
                            <div class="doc-rating">
                                <div class="rating">
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star empty">★</span>
                                </div>
                                <span class="rating-value">4.0</span>
                            </div>
                        </div>
                        
                        <div class="doc-item">
                            <div class="doc-icon">
                                <i class="bi bi-file-earmark-excel"></i>
                            </div>
                            <div class="doc-info">
                                <h6 class="doc-title">市场分析报告2023</h6>
                                <div class="doc-meta">
                                    <span class="doc-category">业务文档</span>
                                    <span class="doc-views"><i class="bi bi-eye"></i> 152</span>
                                </div>
                            </div>
                            <div class="doc-rating">
                                <div class="rating">
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star half">★</span>
                                    <span class="star empty">★</span>
                                </div>
                                <span class="rating-value">3.5</span>
                            </div>
                        </div>
                        
                        <div class="doc-item">
                            <div class="doc-icon">
                                <i class="bi bi-file-earmark-ppt"></i>
                            </div>
                            <div class="doc-info">
                                <h6 class="doc-title">产品路线图</h6>
                                <div class="doc-meta">
                                    <span class="doc-category">业务文档</span>
                                    <span class="doc-views"><i class="bi bi-eye"></i> 118</span>
                                </div>
                            </div>
                            <div class="doc-rating">
                                <div class="rating">
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                    <span class="star filled">★</span>
                                </div>
                                <span class="rating-value">5.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 知识增长和文档趋势 -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="card-title">知识库增长趋势</h5>
                    <div class="card-actions">
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="bi bi-funnel"></i> 按部门筛选
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">所有部门</a></li>
                                <li><a class="dropdown-item" href="#">研发部</a></li>
                                <li><a class="dropdown-item" href="#">产品部</a></li>
                                <li><a class="dropdown-item" href="#">设计部</a></li>
                                <li><a class="dropdown-item" href="#">市场部</a></li>
                                <li><a class="dropdown-item" href="#">销售部</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="trend-metrics">
                                <div class="trend-metric-item">
                                    <div class="metric-label">文档总数</div>
                                    <div class="metric-value">2,547</div>
                                    <div class="metric-change increase">较上月 +152</div>
                                </div>
                                <div class="trend-metric-item">
                                    <div class="metric-label">累计贡献者</div>
                                    <div class="metric-value">187</div>
                                    <div class="metric-change increase">较上月 +12</div>
                                </div>
                                <div class="trend-metric-item">
                                    <div class="metric-label">月均增长率</div>
                                    <div class="metric-value">6.2%</div>
                                    <div class="metric-change increase">持续增长</div>
                                </div>
                                <div class="trend-metric-item">
                                    <div class="metric-label">预测下月增长</div>
                                    <div class="metric-value">~170</div>
                                    <div class="metric-change">基于历史数据</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="chart-container">
                                <canvas id="growthChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 假设这里使用Chart.js绘制图表
        
        // 访问趋势图
        const trendCtx = document.getElementById('trendChart').getContext('2d');
        const trendChart = new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: ['1周前', '6天前', '5天前', '4天前', '3天前', '2天前', '昨天', '今天'],
                datasets: [{
                    label: '访问量',
                    data: [320, 380, 375, 410, 390, 450, 480, 440],
                    borderColor: '#4e73df',
                    backgroundColor: 'rgba(78, 115, 223, 0.05)',
                    tension: 0.3,
                    fill: true
                }, {
                    label: '检索量',
                    data: [250, 280, 270, 340, 350, 380, 410, 390],
                    borderColor: '#36b9cc',
                    backgroundColor: 'rgba(54, 185, 204, 0.05)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: {
                            drawBorder: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
        
        // 知识类型分布图
        const distributionCtx = document.getElementById('distributionChart').getContext('2d');
        const distributionChart = new Chart(distributionCtx, {
            type: 'doughnut',
            data: {
                labels: ['技术文档', '管理文档', '业务文档', '培训资料', '其他'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: [
                        '#4e73df',
                        '#1cc88a',
                        '#36b9cc',
                        '#f6c23e',
                        '#e74a3b'
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        
        // 热门关键词图
        const keywordsCtx = document.getElementById('keywordsChart').getContext('2d');
        const keywordsChart = new Chart(keywordsCtx, {
            type: 'bar',
            data: {
                labels: ['API', '微服务', '设计规范', '接口文档', '前端开发', '测试'],
                datasets: [{
                    label: '搜索次数',
                    data: [280, 230, 190, 180, 150, 120],
                    backgroundColor: '#4e73df',
                    borderRadius: 3
                }]
            },
            options: {
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
        
        // 知识库增长趋势图
        const growthCtx = document.getElementById('growthChart').getContext('2d');
        const growthChart = new Chart(growthCtx, {
            type: 'line',
            data: {
                labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
                datasets: [{
                    label: '文档数量',
                    data: [1580, 1670, 1820, 1950, 2050, 2180, 2240, 2300, 2390, 2450, 2510, 2547],
                    borderColor: '#4e73df',
                    backgroundColor: 'rgba(78, 115, 223, 0.05)',
                    tension: 0.3,
                    fill: true
                }, {
                    label: '活跃贡献者',
                    data: [120, 125, 130, 142, 145, 150, 148, 152, 160, 175, 182, 187],
                    borderColor: '#1cc88a',
                    backgroundColor: 'rgba(28, 200, 138, 0.05)',
                    tension: 0.3,
                    fill: true,
                    yAxisID: 'y1'
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: '文档数量'
                        }
                    },
                    y1: {
                        beginAtZero: false,
                        position: 'right',
                        title: {
                            display: true,
                            text: '贡献者数量'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    });
</script>

<style>
    .trend-metrics {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .trend-metric-item {
        padding: 10px;
        margin-bottom: 10px;
        border-left: 3px solid #4e73df;
        background-color: #f8f9fc;
        border-radius: 0 4px 4px 0;
    }
    
    .metric-label {
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 4px;
    }
    
    .metric-value {
        font-size: 1.5rem;
        font-weight: 600;
        color: #2e3a5c;
        margin-bottom: 4px;
    }
    
    .metric-change {
        font-size: 0.75rem;
        color: #6c757d;
    }
    
    .metric-change.increase {
        color: #1cc88a;
    }
    
    .metric-change.decrease {
        color: #e74a3b;
    }
</style> 
<!DOCTYPE html>
<div id="role-management-module" class="container-fluid py-3">
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h4 class="mb-0">角色管理</h4>
        <div>
          <button class="btn btn-primary" id="add-role-btn">
            <i class="bi bi-people-fill me-1"></i>添加角色
          </button>
          <button class="btn btn-outline-secondary ms-2" id="permission-batch-btn">
            <i class="bi bi-shield-lock me-1"></i>批量权限设置
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- 角色列表 -->
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">系统角色</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="ps-3">角色名称</th>
                  <th>描述</th>
                  <th>用户数</th>
                  <th>创建时间</th>
                  <th class="text-end pe-3">操作</th>
                </tr>
              </thead>
              <tbody>
                <!-- 系统管理员 -->
                <tr>
                  <td class="ps-3">
                    <div class="d-flex align-items-center">
                      <div class="role-icon bg-primary-soft rounded-circle p-2 me-2">
                        <i class="bi bi-person-gear"></i>
                      </div>
                      <div>
                        <div class="fw-bold">系统管理员</div>
                        <span class="badge bg-primary">系统内置</span>
                      </div>
                    </div>
                  </td>
                  <td>拥有系统所有权限，可进行所有操作和管理</td>
                  <td>3</td>
                  <td>2023-01-01</td>
                  <td class="text-end pe-3">
                    <button class="btn btn-sm btn-outline-primary me-1" title="查看权限">
                      <i class="bi bi-shield"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" title="编辑角色" disabled>
                      <i class="bi bi-pencil"></i>
                    </button>
                  </td>
                </tr>
                
                <!-- 部门管理员 -->
                <tr>
                  <td class="ps-3">
                    <div class="d-flex align-items-center">
                      <div class="role-icon bg-success-soft rounded-circle p-2 me-2">
                        <i class="bi bi-person-badge"></i>
                      </div>
                      <div>
                        <div class="fw-bold">部门管理员</div>
                        <span class="badge bg-primary">系统内置</span>
                      </div>
                    </div>
                  </td>
                  <td>管理所属部门的用户和文档，有限的系统管理权限</td>
                  <td>12</td>
                  <td>2023-01-01</td>
                  <td class="text-end pe-3">
                    <button class="btn btn-sm btn-outline-primary me-1" title="查看权限">
                      <i class="bi bi-shield"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" title="编辑角色">
                      <i class="bi bi-pencil"></i>
                    </button>
                  </td>
                </tr>
                
                <!-- 开发人员 -->
                <tr>
                  <td class="ps-3">
                    <div class="d-flex align-items-center">
                      <div class="role-icon bg-info-soft rounded-circle p-2 me-2">
                        <i class="bi bi-code-square"></i>
                      </div>
                      <div>
                        <div class="fw-bold">开发人员</div>
                      </div>
                    </div>
                  </td>
                  <td>负责系统开发和维护的技术人员</td>
                  <td>25</td>
                  <td>2023-01-15</td>
                  <td class="text-end pe-3">
                    <button class="btn btn-sm btn-outline-primary me-1" title="查看权限">
                      <i class="bi bi-shield"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary me-1" title="编辑角色">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" title="删除角色">
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
                
                <!-- 产品经理 -->
                <tr>
                  <td class="ps-3">
                    <div class="d-flex align-items-center">
                      <div class="role-icon bg-warning-soft rounded-circle p-2 me-2">
                        <i class="bi bi-kanban"></i>
                      </div>
                      <div>
                        <div class="fw-bold">产品经理</div>
                      </div>
                    </div>
                  </td>
                  <td>负责产品规划、管理和迭代的产品负责人</td>
                  <td>18</td>
                  <td>2023-01-20</td>
                  <td class="text-end pe-3">
                    <button class="btn btn-sm btn-outline-primary me-1" title="查看权限">
                      <i class="bi bi-shield"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary me-1" title="编辑角色">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" title="删除角色">
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
                
                <!-- 测试人员 -->
                <tr>
                  <td class="ps-3">
                    <div class="d-flex align-items-center">
                      <div class="role-icon bg-danger-soft rounded-circle p-2 me-2">
                        <i class="bi bi-bug"></i>
                      </div>
                      <div>
                        <div class="fw-bold">测试人员</div>
                      </div>
                    </div>
                  </td>
                  <td>负责系统功能测试和质量保证</td>
                  <td>15</td>
                  <td>2023-01-22</td>
                  <td class="text-end pe-3">
                    <button class="btn btn-sm btn-outline-primary me-1" title="查看权限">
                      <i class="bi bi-shield"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary me-1" title="编辑角色">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" title="删除角色">
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
                
                <!-- 普通用户 -->
                <tr>
                  <td class="ps-3">
                    <div class="d-flex align-items-center">
                      <div class="role-icon bg-secondary-soft rounded-circle p-2 me-2">
                        <i class="bi bi-person"></i>
                      </div>
                      <div>
                        <div class="fw-bold">普通用户</div>
                        <span class="badge bg-primary">系统内置</span>
                      </div>
                    </div>
                  </td>
                  <td>基本的访问权限，可以查看和使用被授权的内容</td>
                  <td>114</td>
                  <td>2023-01-01</td>
                  <td class="text-end pe-3">
                    <button class="btn btn-sm btn-outline-primary me-1" title="查看权限">
                      <i class="bi bi-shield"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" title="编辑角色">
                      <i class="bi bi-pencil"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 角色统计和提示 -->
    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">角色统计</h5>
        </div>
        <div class="card-body">
          <div class="mb-4">
            <div id="roleDistributionChart" style="height: 200px;"></div>
          </div>
          <div class="row g-3">
            <div class="col-6">
              <div class="border rounded p-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <span class="d-block text-muted">总角色数</span>
                    <h3 class="mb-0">6</h3>
                  </div>
                  <div class="bg-primary-soft rounded-circle p-2">
                    <i class="bi bi-people fs-4"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="border rounded p-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <span class="d-block text-muted">自定义角色</span>
                    <h3 class="mb-0">3</h3>
                  </div>
                  <div class="bg-success-soft rounded-circle p-2">
                    <i class="bi bi-pencil-square fs-4"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">提示信息</h5>
        </div>
        <div class="card-body">
          <div class="alert alert-info mb-3">
            <h6><i class="bi bi-info-circle me-2"></i>什么是角色管理？</h6>
            <p class="small mb-0">角色是用户权限的集合，通过分配角色可以快速配置用户的访问权限。系统内置角色不可删除，但可以修改其权限。</p>
          </div>
          <div class="alert alert-warning mb-0">
            <h6><i class="bi bi-exclamation-triangle me-2"></i>权限变更注意事项</h6>
            <p class="small mb-0">修改角色权限将会影响所有关联该角色的用户，请谨慎操作。权限变更将在用户下次登录时生效。</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 添加/编辑角色模态框 -->
<div class="modal fade" id="roleModal" tabindex="-1" aria-labelledby="roleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="roleModalLabel">添加角色</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
      </div>
      <div class="modal-body">
        <form id="role-form" class="needs-validation" novalidate>
          <div class="mb-3">
            <label for="role-name" class="form-label">角色名称</label>
            <input type="text" class="form-control" id="role-name" placeholder="输入角色名称" required>
            <div class="invalid-feedback">请输入角色名称</div>
          </div>
          <div class="mb-3">
            <label for="role-description" class="form-label">角色描述</label>
            <textarea class="form-control" id="role-description" rows="3" placeholder="描述该角色的主要职责和权限范围"></textarea>
          </div>
          
          <hr class="my-4">
          
          <h6 class="mb-3">权限设置</h6>
          
          <div class="row mb-3">
            <div class="col-md-4">
              <div class="nav flex-column nav-pills" id="permission-tab" role="tablist">
                <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#doc-permissions" type="button">知识库管理</button>
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#user-permissions" type="button">用户管理</button>
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#system-permissions" type="button">系统设置</button>
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#analytics-permissions" type="button">数据分析</button>
              </div>
            </div>
            <div class="col-md-8">
              <div class="tab-content" id="permission-tabContent">
                <!-- 知识库管理权限 -->
                <div class="tab-pane fade show active" id="doc-permissions">
                  <div class="list-group">
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 查看文档
                      <select class="form-select form-select-sm w-auto float-end">
                        <option value="all">所有文档</option>
                        <option value="department">部门文档</option>
                        <option value="own">个人文档</option>
                      </select>
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 创建文档
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 编辑文档
                      <select class="form-select form-select-sm w-auto float-end">
                        <option value="all">所有文档</option>
                        <option value="department">部门文档</option>
                        <option value="own">个人文档</option>
                      </select>
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 删除文档
                      <select class="form-select form-select-sm w-auto float-end">
                        <option value="all">所有文档</option>
                        <option value="department">部门文档</option>
                        <option value="own">个人文档</option>
                      </select>
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 批量导入/导出
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 管理知识分类
                    </label>
                  </div>
                </div>
                
                <!-- 用户管理权限 -->
                <div class="tab-pane fade" id="user-permissions">
                  <div class="list-group">
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 查看用户
                      <select class="form-select form-select-sm w-auto float-end">
                        <option value="all">所有用户</option>
                        <option value="department">部门用户</option>
                      </select>
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 创建用户
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 编辑用户
                      <select class="form-select form-select-sm w-auto float-end">
                        <option value="all">所有用户</option>
                        <option value="department">部门用户</option>
                      </select>
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 管理角色
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 分配权限
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 查看操作日志
                    </label>
                  </div>
                </div>
                
                <!-- 系统设置权限 -->
                <div class="tab-pane fade" id="system-permissions">
                  <div class="list-group">
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 查看系统设置
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 修改系统参数
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 管理插件与集成
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 备份与恢复
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 系统维护
                    </label>
                  </div>
                </div>
                
                <!-- 数据分析权限 -->
                <div class="tab-pane fade" id="analytics-permissions">
                  <div class="list-group">
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 查看统计数据
                      <select class="form-select form-select-sm w-auto float-end">
                        <option value="all">所有数据</option>
                        <option value="department">部门数据</option>
                      </select>
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 导出报表
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 配置仪表盘
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 设置分析指标
                    </label>
                    <label class="list-group-item">
                      <input class="form-check-input me-1" type="checkbox"> 管理报表订阅
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" id="save-role-btn">保存</button>
      </div>
    </div>
  </div>
</div>

<!-- 删除角色确认模态框 -->
<div class="modal fade" id="deleteRoleModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">确认删除</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>确定要删除此角色吗？此操作不可撤销。</p>
        <div class="alert alert-warning">
          <div class="d-flex">
            <div class="me-2">
              <i class="bi bi-exclamation-triangle-fill"></i>
            </div>
            <div>
              <strong>警告：</strong> 删除角色将会影响所有关联此角色的用户，这些用户将被自动分配为"普通用户"角色。
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="button" class="btn btn-danger" id="confirm-delete-role-btn">确认删除</button>
      </div>
    </div>
  </div>
</div> 